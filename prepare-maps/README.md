Подготовка карт для оффлайн-использования
========

## Выбор региона
1. Перейдите на [https://download.geofabrik.de](https://download.geofabrik.de) и выберите нужный регион.
2. В разделе «Commonly Used Formats», скопируйте ссылку на загрузку файла в формате .osm.pbf.

## Создание ВМ
В общем случае, быстрее и удобнее переконвертировать карту на выделенной виртуальной машине с поминутной тарификацией.
Например, тарифная сетка Яндекс.Облако позволяет отрендерить карту СЗФО за пару рублей на прерываемой ВМ. 

Рекомендуемая конфигурация для рендера карт СЗФО:
 - 8x vCPU*
 - 12Gb RAM**
 - 8Gb SSD
 - Ubuntu 20.04
 - Прерываемая ВМ

> *Количество vCPU может быть любым, рендерер умеет распараллеливать часть задач на неограниченное количество ядер. 
> Следует использовать dedicated vCPU с 100% выделением времени, так как задача рендера карты очень CPU intensive и 
> использует почти всё доступное процессорное время.

> ** Объём памяти зависит от региона: для СЗФО от Geofabrik достаточно примерно 4Gb для работы рендерера и ~2Gb 
> для хранения PBF и MBTiles файлов. Хранение этих файлов в tmpfs опционально, однако позволяет значительно ускорить 
> операции над MBTiles-базой и сэкономить на оплате услуг облачного провайдера.

По завершению рендеринга карт, скопируйте итоговый MBTiles файл и удалите виртуальную машину, чтобы сократить 
затраты на её оплату. Персистентное хранение данных не требуется, а подготовка виртуальной машины к работе занимает
всего несколько минут.

## Рендер
1. Подключившись к виртуальной машине, склонируйте этот репозиторий целиком, или только файл render.sh из этой директории.
2. Сделайте файл исполняемым: `chmod +x render.sh`
3. Запустите деплой окружения и рендер карт, указав прямую ссылку на .osm.pbf файл из шага «Выбор региона»:
   `sudo ./render.sh "https://download.geofabrik.de/........"`
4. После завершения работы скрипта, готовый MBTiles-файл будет находится в `/srv/store/maps/result.mbtiles`
